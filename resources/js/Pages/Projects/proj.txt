<script setup lang="ts">
import { Head } from "@inertiajs/vue3";
import AppLayout from "@/Layouts/AppLayout.vue";
import Card from "@/Components/Front/Card.vue";
import { ref, onMounted } from 'vue';
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import { Project } from '@/types';

// Register ScrollTrigger plugin
gsap.registerPlugin(ScrollTrigger);

// Props
defineProps<{
  projects?: Project[];
}>();

defineOptions({ layout: AppLayout });

// Refs for elements to animate
const headerRef = ref(null);
const projectsRef = ref([]);

// Animation on mounted
onMounted(() => {
  // Animate header
  gsap.from(headerRef.value, {
    opacity: 0,
    y: 50,
    duration: 1,
    scrollTrigger: {
      trigger: headerRef.value,
      start: 'top 80%', // Trigger when the top of the header is at 80% of the viewport
    },
  });

  // Animate each project card
  projectsRef.value.forEach((project, index) => {
    gsap.from(project, {
      opacity: 0,
      y: 30,
      duration: 0.6,
      delay: index * 0.1, // Slight delay for staggered effect
      scrollTrigger: {
        trigger: project,
        start: 'top 90%', // Trigger when the top of each card is at 90% of the viewport
      },
    });
  });
});
</script>

<template>
  <Head title="Projects" />

  <main class="flex-auto mb-10 sm:mb-14">
    <div class="mt-16 sm:px-8 sm:mt-16">
      <div class="w-full max-w-3xl mx-auto lg:px-8">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="max-w-2xl mx-auto lg:max-w-5xl">
            <!-- Header Section -->
            <header ref="headerRef" class="max-w-2xl">
              <h1 class="text-4xl font-bold tracking-tight text-zinc-800 sm:text-5xl dark:text-zinc-100">
                Things I've made trying to put my dent in the universe.
              </h1>
              <p class="mt-6 text-lg text-zinc-600 dark:text-zinc-400">
                I've worked on tons of little projects over the years but these are the ones that I'm most proud of.
                Many of them are just simple artworks, not an entire case-study.
              </p>
            </header>

            <!-- Projects Section -->
            <div class="mt-16 sm:mt-20">
              <ul
                role="list"
                class="grid grid-cols-2 gap-2 lg:grid-cols-3"
              >
                <li
                  v-for="(project, index) in projects"
                  :key="project.pid"
                  class="relative flex flex-col items-start group"
                  ref="el => projectsRef.value[index] = el"
                >
                  <Card :project="project" />
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</template>
